<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Board Form</title>
    <link rel="stylesheet" th:href="@{/css/base.css}" />
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
</head>
<body>
    <div th:replace="layout/header::header"></div>

    <div class="container">
        <div class="page-header">
            <h1>권한 관리</h1>
        </div>
        
        <br/><br/><br/>
        <div id="mainHide">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th class="col-md-1">#</th>
                    <th class="col-md-2">Role Name</th>
                    <th class="col-md-3">Role Division</th>
                    <th class="col-md-5">Usage</th>
                </tr>
                </thead>
                <tbody>
                    <tr th:each="role : ${roleList}">
                        <td th:text="${role.id}"></td>
                        <td> <a th:href="'/permission?roleId='+${role.id}" th:text="${role.name}"></a></td>
                        <td th:text="${role.roleDivision}"></td>
           				<td th:text="${role.roleUsage}"></td>	
                       
                    </tr>
                </tbody>
            </table>
            <form th:action='@{/permission/edit}'
     				 method="POST">
     		
            <button class="btn btn-primary btn-block" style="width:100px;margin:10px 0;" type="submit" th:text="Save" id="insert"></button>
            <input type="hidden" th:name="roleId" th:value="${param.role}" />
            <table class="table table-hover">
                <thead>
                <tr> 
                 
                    <th class="col-md-2">Role</th>
                       <th class="col-md-1">#</th>
                    <th class="col-md-2">Permission Resource</th>
                    <th class="col-md-3">Permission Level</th>
                    <th class="col-md-5">Usage</th>
                </tr>
                </thead>
               
                <tbody>
                    <tr th:each="permission : ${permissionList}">
                    	<td th:text ="${rolename}"></td>
                        <td th:text="${permission.id}"></td>
                        <td th:text="${permission.resourceId}"></td>
                        <td th:text="${permission.perLevel}"></td>
           		 	  <th:block th:if="${param.role}!=null" >
           		 	  	<td>
           		 	  	   
           		 	  	
           		 	  	 <input type="checkbox" th:name="isChecked" id="perchecked"th:checked="${permission.roleId==param.role}"
           		 	  	 th:value="'add'+${permission.id}"/>
           		 	  	 </td>
           		 	  </th:block>	
                      <th:block th:unless="${param.role}!=null">
                      <td th:text="NONE"></td>
                      </th:block>
                      
                      
                      
                    </tr>
                </tbody>
            </table>
            </form>
        </div>
        <br/>
    
    </div>

    <div th:replace="layout/footer::footer"></div>
        <script th:src="@{/js/jquery.min.js}"></script>
    <script th:if="!${permission?.id}">
        $('#insert').click(function () {
            var jsonData = JSON.stringify({
                title: $('#post_title').val(),
               // subTitle: $('#board_sub_title').val(),
                content: $('#post_content').val(),
                postType: $('#post_type option:selected').val()
            });
            $.ajax({
                       url: "http://localhost:8080/api/boards",
                       type: "POST",
                       data: jsonData,
                       contentType: "application/json",
                      // headers: {
                      //     "Authorization": "Basic " + btoa("havi" + ":" + "test")
                      // },
                       dataType: "json",
                           success: function () {
                               alert('저장 성공!');
                               location.href = '/permission/list';
                       },
                       error: function () {
                           alert('저장 실패!');
                       }
                   });
        });
   
    </script>
</body>
</html>